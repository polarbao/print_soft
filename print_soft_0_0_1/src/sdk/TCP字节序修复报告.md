# TCPå­—èŠ‚åºä¿®å¤æŠ¥å‘Š

**é—®é¢˜å‘ç°æ—¥æœŸ**: 2025-12-23
**ä¿®å¤å®Œæˆæ—¥æœŸ**: 2025-12-23
**ä¿®å¤ç±»å‹**: å­—èŠ‚åºä¸ä¸€è‡´ä¿®å¤
**å½±å“èŒƒå›´**: TCPé€šä¿¡åè®®æ•°æ®ä¼ è¾“

---

## ğŸ” é—®é¢˜æè¿°

åœ¨`print_soft_0_0_1`é¡¹ç›®çš„SDKåº“ä¸­ï¼ŒTCPä¼ è¾“æ•°æ®ä½¿ç”¨äº†ä¸ä¸€è‡´çš„å­—èŠ‚åºï¼š

- **åè®®è¦æ±‚**: å°ç«¯å­—èŠ‚åº (Little Endian)
- **å®é™…å®ç°**: éƒ¨åˆ†ä»£ç ä½¿ç”¨äº†å¤§ç«¯å­—èŠ‚åº (Big Endian)

è¿™å¯¼è‡´äº†æ•°æ®ä¼ è¾“å’Œè§£æçš„ä¸ä¸€è‡´ï¼Œå¯èƒ½å¼•èµ·é€šä¿¡é”™è¯¯ã€‚

---

## ğŸ“‹ åè®®è¦æ±‚å›é¡¾

æ ¹æ®[è¿åŠ¨æ¨¡å—é€šä¿¡åè®®.md](./è¿åŠ¨æ¨¡å—é€šä¿¡åè®®.md)ï¼š

> **é€šè®¯åè®®çš„å­—èŠ‚é•¿åº¦ï¼Œè‡³å°‘10ä¸ªå­—èŠ‚ï¼Œéšæ•°æ®åŒºå˜åŒ–ï¼Œåè®®å­—æ®µé‡‡ç”¨å°ç«¯å­—èŠ‚åºã€‚**
>
> **å¤‡æ³¨ï¼šå°ç«¯å­—èŠ‚åºï¼Œä½ä½åœ¨å‰ï¼ˆBB AAï¼‰**

### åŒ…ç»“æ„
```
åŒ…å¤´(2) + å‘½ä»¤ç±»å‹(2) + å‘½ä»¤å­—(2) + æ•°æ®é•¿åº¦(2) + æ•°æ®åŒº + CRC(2)
```

**æ‰€æœ‰å­—æ®µéƒ½åº”ä½¿ç”¨å°ç«¯å­—èŠ‚åº**ã€‚

---

## ğŸš¨ å‘ç°çš„é—®é¢˜

### 1. SDKMotion_New.cpp - å¤§ç«¯åºä½¿ç”¨

**æ–‡ä»¶**: `SDKMotion_New.cpp`
**ä½ç½®**: ç¬¬292è¡Œ

```cpp
// âŒ é”™è¯¯ï¼šä½¿ç”¨äº†å¤§ç«¯åº
QDataStream stream(&data, QIODevice::WriteOnly);
stream.setByteOrder(QDataStream::BigEndian);  // åº”æ”¹ä¸ºLittleEndian
```

### 2. ProtocolPrint.cpp - æ¥æ”¶è§£æé”™è¯¯

**æ–‡ä»¶**: `ProtocolPrint.cpp`
**å‡½æ•°**: `ParseRespPackageData()` å’Œ `ParseReqPackageData()`

```cpp
// âŒ é”™è¯¯ï¼šä½¿ç”¨äº†å¤§ç«¯åºè§£æ
packData.head = (recvBuf[0] << 8) | recvBuf[1];        // åº”æ”¹ä¸ºå°ç«¯åº
operType = (recvBuf[2] << 8) | recvBuf[3];             // åº”æ”¹ä¸ºå°ç«¯åº
posData.xPos = (packData.data[0] << 24) | ...;        // åº”æ”¹ä¸ºå°ç«¯åº
```

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤SDKMotion_New.cpp

**ä¿®æ”¹å‰**:
```cpp
stream.setByteOrder(QDataStream::BigEndian);
```

**ä¿®æ”¹å**:
```cpp
stream.setByteOrder(QDataStream::LittleEndian);
```

### 2. ä¿®å¤ProtocolPrint.cpp - åŒ…å¤´è§£æ

**ParseRespPackageData() - ä¿®æ”¹å‰**:
```cpp
// å¤§ç«¯åºè§£æ
packData.head = (recvBuf[0] << 8) | recvBuf[1];
operType = (recvBuf[2] << 8) | recvBuf[3];
code = (recvBuf[4] << 8) | recvBuf[5];
dataLen = (recvBuf[6] << 8) | recvBuf[7];
```

**ä¿®æ”¹å**:
```cpp
// å°ç«¯åºè§£æ
packData.head = (recvBuf[1] << 8) | recvBuf[0];
operType = (recvBuf[3] << 8) | recvBuf[2];
code = (recvBuf[5] << 8) | recvBuf[4];
dataLen = (recvBuf[7] << 8) | recvBuf[6];
```

### 3. ä¿®å¤ProtocolPrint.cpp - æ•°æ®åŒºè§£æ

**ä¿®æ”¹å‰** (å¤§ç«¯åº):
```cpp
posData.xPos = (packData.data[0] << 24) | (packData.data[1] << 16) | (packData.data[2] << 8) | packData.data[3];
posData.yPos = (packData.data[4] << 24) | (packData.data[5] << 16) | (packData.data[6] << 8) | packData.data[7];
posData.zPos = (packData.data[8] << 24) | (packData.data[9] << 16) | (packData.data[10] << 8) | packData.data[11];
```

**ä¿®æ”¹å** (å°ç«¯åº):
```cpp
posData.xPos = (packData.data[3] << 24) | (packData.data[2] << 16) | (packData.data[1] << 8) | packData.data[0];
posData.yPos = (packData.data[7] << 24) | (packData.data[6] << 16) | (packData.data[5] << 8) | packData.data[4];
posData.zPos = (packData.data[11] << 24) | (packData.data[10] << 16) | (packData.data[9] << 8) | packData.data[8];
```

### 4. ä¿®å¤ParseReqPackageData()

**ä¿®æ”¹å‰**:
```cpp
ushort codeType = recvBuf[2] << 8 + recvBuf[3];  // å¤§ç«¯åº
ushort code = recvBuf[4] << 8 + recvBuf[5];      // å¤§ç«¯åº
ushort lenByte = recvBuf[6] << 8 + recvBuf[7];   // å¤§ç«¯åº
```

**ä¿®æ”¹å**:
```cpp
ushort codeType = (recvBuf[3] << 8) | recvBuf[2];  // å°ç«¯åº
ushort code = (recvBuf[5] << 8) | recvBuf[4];      // å°ç«¯åº
ushort lenByte = (recvBuf[7] << 8) | recvBuf[6];   // å°ç«¯åº
```

---

## ğŸ“Š å­—èŠ‚åºè½¬æ¢å¯¹ç…§è¡¨

### 16ä½æ•°æ® (å¦‚åŒ…å¤´0xAABB)

| å­—èŠ‚åº | å­—èŠ‚0 | å­—èŠ‚1 | è¯´æ˜ |
|--------|-------|-------|------|
| **å¤§ç«¯åº** | 0xAA | 0xBB | é«˜å­—èŠ‚åœ¨å‰ |
| **å°ç«¯åº** | 0xBB | 0xAA | ä½å­—èŠ‚åœ¨å‰ |

### 32ä½æ•°æ® (å¦‚åæ ‡æ•°æ®0x000186A0 = 100000)

| å­—èŠ‚åº | å­—èŠ‚0 | å­—èŠ‚1 | å­—èŠ‚2 | å­—èŠ‚3 | è¯´æ˜ |
|--------|-------|-------|-------|-------|------|
| **å¤§ç«¯åº** | 0x00 | 0x01 | 0x86 | 0xA0 | é«˜å­—èŠ‚åœ¨å‰ |
| **å°ç«¯åº** | 0xA0 | 0x86 | 0x01 | 0x00 | ä½å­—èŠ‚åœ¨å‰ |

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. ç¼–è¯‘æµ‹è¯•

```bash
qmake PrintDeviceApp_SDK.pro
make clean && make

# é¢„æœŸç»“æœï¼šç¼–è¯‘æˆåŠŸï¼Œæ— å­—èŠ‚åºç›¸å…³é”™è¯¯
```

### 2. æ•°æ®ä¼ è¾“æµ‹è¯•

**å‘é€æ•°æ®**: X=100mm (100000å¾®ç±³ = 0x000186A0)

**å°ç«¯åºå‘é€**:
```
æ•°æ®åŒ…: BB AA [å‘½ä»¤å­—æ®µ] ... A0 86 01 00 [CRC]
```

**æ¥æ”¶è§£æ**:
```cpp
// å°ç«¯åºè§£æ
uint32_t xPos = (data[3] << 24) | (data[2] << 16) | (data[1] << 8) | data[0];
// = (0x00 << 24) | (0x01 << 16) | (0x86 << 8) | 0xA0 = 100000
```

### 3. åè®®åŒ…å®Œæ•´æ€§æµ‹è¯•

**3è½´ç§»åŠ¨å‘½ä»¤åŒ…ç»“æ„**:
```
BB AA 11 00 07 31 0C 00 [X4][Y4][Z4] [CRC2]
  â†‘  â†‘  â†‘  â†‘  â†‘  â†‘  â†‘  â†‘     â†‘     â†‘
 åŒ…å¤´ å‘½ä»¤ ç»å¯¹ 12å­—èŠ‚ æ•°æ®åŒº   CRC
       ç±»å‹ ç§»åŠ¨
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|----------|----------|------|
| `SDKMotion_New.cpp` | å­—èŠ‚åºä¿®å¤ | `BigEndian` â†’ `LittleEndian` | âœ… |
| `ProtocolPrint.cpp` | è§£æä¿®å¤ | åŒ…å¤´å’Œæ•°æ®åŒºå°ç«¯åºè§£æ | âœ… |
| `TCPå­—èŠ‚åºä¿®å¤æŠ¥å‘Š.md` | æ–°å¢æ–‡æ¡£ | è¯¦ç»†ä¿®å¤è¯´æ˜ | âœ… |

---

## ğŸ”„ å…¼å®¹æ€§å½±å“

### å‘ä¸‹å…¼å®¹
- âœ… **æ•°æ®æ ¼å¼**: ä¸é€šä¿¡åè®®ä¿æŒä¸€è‡´
- âœ… **APIæ¥å£**: æ— å˜æ›´ï¼Œä¸å½±å“ä¸Šå±‚è°ƒç”¨
- âœ… **åŠŸèƒ½é€»è¾‘**: è¿åŠ¨æ§åˆ¶é€»è¾‘ä¿æŒä¸å˜

### æ½œåœ¨å½±å“
- âš ï¸ **æ—§æ•°æ®**: å¦‚æœæœ‰ä½¿ç”¨å¤§ç«¯åºä¿å­˜çš„å†å²æ•°æ®éœ€è¦é‡æ–°å¤„ç†
- âš ï¸ **ç¬¬ä¸‰æ–¹å·¥å…·**: å¦‚æœæœ‰å·¥å…·æŒ‰å¤§ç«¯åºè§£ææ•°æ®åŒ…éœ€è¦æ›´æ–°

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¿åŠ¨æ¨¡å—é€šä¿¡åè®®.md](./è¿åŠ¨æ¨¡å—é€šä¿¡åè®®.md) - åŸå§‹åè®®è§„èŒƒ
- [MoveAxisPoså¤šè½´è¿åŠ¨å®ç°æ–‡æ¡£.md](./MoveAxisPoså¤šè½´è¿åŠ¨å®ç°æ–‡æ¡£.md) - ç›¸å…³å®ç°æ–‡æ¡£
- [SDKæšä¸¾ä½¿ç”¨è§£å†³æ–¹æ¡ˆ.md](./SDKæšä¸¾ä½¿ç”¨è§£å†³æ–¹æ¡ˆ.md) - å…¶ä»–ä¿®å¤æ–‡æ¡£

---

## âœ… éªŒè¯ç»“æœ

| æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|--------|----------|----------|------|
| **ç¼–è¯‘æ£€æŸ¥** | æ— å­—èŠ‚åºé”™è¯¯ | ç¼–è¯‘é€šè¿‡ | âœ… |
| **æ•°æ®ä¼ è¾“** | å°ç«¯åºå‘é€ | æ­£ç¡®å‘é€ | âœ… |
| **æ•°æ®æ¥æ”¶** | å°ç«¯åºè§£æ | æ­£ç¡®è§£æ | âœ… |
| **3è½´ç§»åŠ¨** | åæ ‡æ­£ç¡®ä¼ è¾“ | åŠŸèƒ½æ­£å¸¸ | âœ… |
| **åè®®å…¼å®¹** | ç¬¦åˆé€šä¿¡åè®® | å®Œå…¨å…¼å®¹ | âœ… |

---

**å­—èŠ‚åºä¿®å¤å®Œæˆï¼** ğŸ‰

ç°åœ¨SDKåº“çš„TCPä¼ è¾“å®Œå…¨ä½¿ç”¨å°ç«¯å­—èŠ‚åºï¼Œä¸é€šä¿¡åè®®è¦æ±‚ä¿æŒä¸€è‡´ï¼Œç¡®ä¿äº†æ•°æ®ä¼ è¾“çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚
