# PrintDeviceSDK é—®é¢˜ä¿®å¤æŒ‡å—

**åŸºäº**: SDKä»£ç å®¡æ ¸æŠ¥å‘Š  
**ä¼˜å…ˆçº§**: é«˜ä¼˜å…ˆçº§é—®é¢˜å¿…é¡»ä¿®å¤  
**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

---

## ğŸ”´ å¿…é¡»ä¿®å¤çš„é—®é¢˜ï¼ˆHigh Priorityï¼‰

### ä¿®å¤1ï¼šMOCæ–‡ä»¶åŒ…å«ä½ç½®é”™è¯¯

**é—®é¢˜**: `PrintDeviceSDK_API.cpp`é”™è¯¯åœ°åŒ…å«äº†`SDKManager.moc`

**ä¿®å¤æ­¥éª¤**:

#### Step 1: ä¿®æ”¹ `PrintDeviceSDK_API.cpp`

```cpp
// ========== PrintDeviceSDK_API.cpp ==========
// æ–‡ä»¶æœ«å°¾ï¼Œåˆ é™¤è¿™ä¸€è¡Œï¼š

// âŒ åˆ é™¤
// #include "src/SDKManager.moc"
```

#### Step 2: ä¿®æ”¹ `src/SDKManager.cpp`

```cpp
// ========== src/SDKManager.cpp ==========
// åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š

void SDKManager::sendEvent(SdkEventType type, int code, const char* message, 
                          double v1, double v2, double v3) {
    QMutexLocker lock(&g_callbackMutex);
    
    if (!g_sdkCallback) {
        return;
    }
    
    g_messageBuffer = QByteArray(message);
    
    SdkEvent event;
    event.type = type;
    event.code = code;
    event.message = g_messageBuffer.constData();
    event.value1 = v1;
    event.value2 = v2;
    event.value3 = v3;
    
    g_sdkCallback(&event);
}

// âœ… æ·»åŠ mocåŒ…å«
#include "SDKManager.moc"
```

**éªŒè¯**: é‡æ–°ç¼–è¯‘ï¼Œä¸åº”æœ‰MOCç›¸å…³é”™è¯¯ã€‚

---

### ä¿®å¤2ï¼šå­—ç¬¦ä¸²ç¼–ç è½¬æ¢

**é—®é¢˜**: å­—ç¬¦ä¸²è½¬æ¢ä¸å®‰å…¨

**ä¿®å¤æ­¥éª¤**:

```cpp
// ========== PrintDeviceSDK_API.cpp ==========

// âŒ ä¿®æ”¹å‰
int ConnectByTCP(const char* ip, unsigned short port) {
    if (!ip) {
        return -1;
    }
    return SDKManager::instance()->connectByTCP(QString(ip), port);
}

// âœ… ä¿®æ”¹å
int ConnectByTCP(const char* ip, unsigned short port) {
    if (!ip) {
        return -1;
    }
    return SDKManager::instance()->connectByTCP(
        QString::fromUtf8(ip), port);  // ä½¿ç”¨fromUtf8
}

// âŒ ä¿®æ”¹å‰
int LoadPrintData(const char* data) {
    if (!data) {
        return -1;
    }
    QString path = QString(data);  // âŒ
    return SDKManager::instance()->loadImageData(path);
}

// âœ… ä¿®æ”¹å
int LoadPrintData(const char* data) {
    if (!data) {
        return -1;
    }
    QString path = QString::fromUtf8(data);  // âœ…
    return SDKManager::instance()->loadImageData(path);
}
```

**éªŒè¯**: æµ‹è¯•åŠ è½½åŒ…å«ä¸­æ–‡è·¯å¾„çš„å›¾åƒæ–‡ä»¶ã€‚

---

### ä¿®å¤3ï¼šQtæ¥å£æ”¹ä¸ºå•ä¾‹æ¨¡å¼

**é—®é¢˜**: å¤šå®ä¾‹ä¼šäº’ç›¸è¦†ç›–

**ä¿®å¤æ­¥éª¤**:

#### Step 1: ä¿®æ”¹ `PrintDeviceController.h`

```cpp
// ========== PrintDeviceController.h ==========

class PRINTDEVICESDK_EXPORT PrintDeviceController : public QObject
{
    Q_OBJECT
    
    Q_PROPERTY(bool connected READ isConnected NOTIFY connectedChanged)
    Q_PROPERTY(QString deviceIp READ deviceIp NOTIFY deviceIpChanged)
    Q_PROPERTY(quint16 devicePort READ devicePort NOTIFY devicePortChanged)

public:
    /**
     * @brief è·å–å•ä¾‹å®ä¾‹
     * @param parent çˆ¶å¯¹è±¡ï¼ˆä»…é¦–æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆï¼‰
     * @return æ§åˆ¶å™¨å®ä¾‹
     * @note è¿™æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå¤šæ¬¡è°ƒç”¨è¿”å›åŒä¸€å®ä¾‹
     */
    static PrintDeviceController* instance(QObject* parent = nullptr);
    
    /**
     * @brief ææ„å‡½æ•°
     */
    ~PrintDeviceController();
    
    // ... å…¶ä»–publicæˆå‘˜ä¿æŒä¸å˜ ...

private:
    /**
     * @brief ç§æœ‰æ„é€ å‡½æ•°ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
     * @param parent çˆ¶å¯¹è±¡
     */
    explicit PrintDeviceController(QObject *parent = nullptr);
    
    // ç§æœ‰å®ç°ç±»
    class Private;
    Private* d;
    
    // é™æ€å®ä¾‹å’Œäº’æ–¥é”
    static PrintDeviceController* s_instance;
    static QMutex s_mutex;
    
    Q_DISABLE_COPY(PrintDeviceController)
};
```

#### Step 2: ä¿®æ”¹ `PrintDeviceController.cpp`

```cpp
// ========== PrintDeviceController.cpp ==========

// é™æ€æˆå‘˜åˆå§‹åŒ–
PrintDeviceController* PrintDeviceController::s_instance = nullptr;
QMutex PrintDeviceController::s_mutex;

// å•ä¾‹å®ç°
PrintDeviceController* PrintDeviceController::instance(QObject* parent)
{
    if (!s_instance) {
        QMutexLocker locker(&s_mutex);
        if (!s_instance) {  // åŒé‡æ£€æŸ¥
            s_instance = new PrintDeviceController(parent);
        }
    }
    return s_instance;
}

// æ„é€ å‡½æ•°æ”¹ä¸ºç§æœ‰
PrintDeviceController::PrintDeviceController(QObject *parent)
    : QObject(parent)
    , d(new Private(this))
{
    // Private::s_instanceç°åœ¨ä¸éœ€è¦äº†
    // ç§»é™¤åŸæ¥çš„ Private::s_instance ç›¸å…³ä»£ç 
}

PrintDeviceController::~PrintDeviceController()
{
    release();
    
    QMutexLocker locker(&s_mutex);
    if (s_instance == this) {
        s_instance = nullptr;
    }
    
    delete d;
}

// Privateç±»çš„é™æ€å›è°ƒéœ€è¦ä¿®æ”¹
class PrintDeviceController::Private
{
public:
    explicit Private(PrintDeviceController* q) 
        : q_ptr(q)
        , initialized(false)
        , connectedState(false)
        , port(0)
    {
    }
    
    ~Private() {}
    
    PrintDeviceController* q_ptr;
    bool initialized;
    bool connectedState;
    QString ip;
    quint16 port;
    
    // é™æ€å›è°ƒå‡½æ•°
    static void sdkEventCallback(const SdkEvent* event);
};

// ä¿®æ”¹å›è°ƒå®ç°
void PrintDeviceController::Private::sdkEventCallback(const SdkEvent* event)
{
    if (!event) {
        return;
    }
    
    // ä½¿ç”¨å•ä¾‹å®ä¾‹
    PrintDeviceController* instance = PrintDeviceController::instance();
    if (!instance) {
        return;
    }
    
    QString message = QString::fromUtf8(event->message);
    SdkEventType type = event->type;
    int code = event->code;
    double v1 = event->value1;
    double v2 = event->value2;
    double v3 = event->value3;
    
    QMetaObject::invokeMethod(instance, [=]() {
        switch (type) {
        case EVENT_TYPE_GENERAL: {
            if (message.contains("Connected", Qt::CaseInsensitive) && 
                message.contains("device", Qt::CaseInsensitive)) {
                instance->d->connectedState = true;
                emit instance->connected();
                emit instance->connectedChanged(true);
            } 
            else if (message.contains("Disconnected", Qt::CaseInsensitive)) {
                instance->d->connectedState = false;
                emit instance->disconnected();
                emit instance->connectedChanged(false);
            }
            emit instance->infoMessage(message);
            break;
        }
        case EVENT_TYPE_ERROR: {
            emit instance->errorOccurred(code, message);
            break;
        }
        case EVENT_TYPE_PRINT_STATUS: {
            int progress = static_cast<int>(v1);
            int currentLayer = static_cast<int>(v2);
            int totalLayers = static_cast<int>(v3);
            emit instance->printProgressUpdated(progress, currentLayer, totalLayers);
            emit instance->printStatusChanged(
                QString("æ‰“å°è¿›åº¦: %1% (%2/%3å±‚)")
                .arg(progress).arg(currentLayer).arg(totalLayers));
            break;
        }
        case EVENT_TYPE_MOVE_STATUS: {
            emit instance->moveStatusChanged(message);
            if (v1 != 0 || v2 != 0 || v3 != 0) {
                emit instance->positionUpdated(v1, v2, v3);
            }
            break;
        }
        case EVENT_TYPE_LOG: {
            emit instance->logMessage(message);
            break;
        }
        }
    }, Qt::QueuedConnection);
}
```

#### Step 3: æ›´æ–°ä½¿ç”¨æ–¹å¼

```cpp
// âŒ åŸæ¥çš„æ–¹å¼ï¼ˆä¸å†æ”¯æŒï¼‰
// PrintDeviceController controller;

// âœ… æ–°çš„æ–¹å¼
PrintDeviceController* controller = PrintDeviceController::instance(this);
controller->initialize("./logs");

// ä¿¡å·è¿æ¥æ–¹å¼ä¸å˜
connect(controller, &PrintDeviceController::connected, []() {
    qDebug() << "Connected";
});
```

**éªŒè¯**: å°è¯•å¤šæ¬¡è°ƒç”¨`instance()`ï¼Œåº”è¯¥è¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚

---

## ğŸŸ¡ å¼ºçƒˆå»ºè®®ä¿®å¤çš„é—®é¢˜ï¼ˆMedium Priorityï¼‰

### ä¿®å¤4ï¼šæ·»åŠ Qtäº‹ä»¶å¾ªç¯æ£€æŸ¥

```cpp
// ========== PrintDeviceSDK_API.cpp ==========

#include <QCoreApplication>
#include <QThread>

int InitSDK(const char* log_dir) {
    // æ£€æŸ¥Qtåº”ç”¨å®ä¾‹
    if (!QCoreApplication::instance()) {
        fprintf(stderr, "é”™è¯¯ï¼šæœªæ£€æµ‹åˆ°Qtåº”ç”¨å®ä¾‹ã€‚\n");
        fprintf(stderr, "è¯·åœ¨main()ä¸­åˆ›å»ºQCoreApplicationæˆ–QApplicationåå†è°ƒç”¨InitSDK()ã€‚\n");
        fprintf(stderr, "ç¤ºä¾‹ï¼š\n");
        fprintf(stderr, "  QApplication app(argc, argv);\n");
        fprintf(stderr, "  InitSDK(\"./logs\");\n");
        return -1;
    }
    
    // æ£€æŸ¥æ˜¯å¦åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨
    if (QThread::currentThread() != QCoreApplication::instance()->thread()) {
        fprintf(stderr, "é”™è¯¯ï¼šInitSDK()å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ã€‚\n");
        return -1;
    }
    
    bool success = SDKManager::instance()->init(log_dir);
    return success ? 0 : -1;
}
```

**éªŒè¯**: åœ¨æ²¡æœ‰Qtåº”ç”¨çš„ç¨‹åºä¸­è°ƒç”¨ï¼Œåº”è¯¥è¿”å›é”™è¯¯ã€‚

---

### ä¿®å¤5ï¼šè°ƒæ•´å¿ƒè·³è¶…æ—¶é€»è¾‘

```cpp
// ========== src/SDKManager.cpp ==========

bool SDKManager::init(const char* log_dir) {
    // ... å‰é¢çš„ä»£ç ä¸å˜ ...
    
    // ä¿®æ”¹å¿ƒè·³é—´éš”
    m_heartbeatSendTimer->setInterval(8000);   // 8ç§’å‘é€ä¸€æ¬¡ï¼ˆåŸ10ç§’ï¼‰
    m_heartbeatCheckTimer->setInterval(10000); // 10ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆåŸ5ç§’ï¼‰
    
    // ... åé¢çš„ä»£ç ä¸å˜ ...
}
```

```cpp
// ========== src/SDKCallback.cpp ==========

void SDKManager::onCheckHeartbeat() {
    QMutexLocker lock(&m_heartbeatMutex);
    
    m_heartbeatTimeout++;
    
    // ä¿®æ”¹è¶…æ—¶é˜ˆå€¼ï¼ˆ3æ¬¡æ£€æŸ¥ = 30ç§’ï¼‰
    if (m_heartbeatTimeout > 3) {
        // æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—
        QString msg = QString("Heartbeat timeout after %1 seconds, disconnecting...")
            .arg(m_heartbeatTimeout * 10);  // 10ç§’ä¸€æ¬¡æ£€æŸ¥
        
        sendEvent(EVENT_TYPE_ERROR, -1, msg.toUtf8().constData());
        
        // å¼‚æ­¥æ–­å¼€è¿æ¥
        QMetaObject::invokeMethod(this, [this]() {
            disconnect();
        }, Qt::QueuedConnection);
    }
}
```

**é…ç½®æ€»ç»“**:
- å¿ƒè·³å‘é€: 8ç§’ä¸€æ¬¡
- å¿ƒè·³æ£€æŸ¥: 10ç§’ä¸€æ¬¡
- è¶…æ—¶é˜ˆå€¼: 3æ¬¡ï¼ˆæ€»å…±30ç§’ï¼‰

**éªŒè¯**: æ‹”æ‰ç½‘çº¿ï¼Œè§‚å¯Ÿ30ç§’åæ˜¯å¦è§¦å‘è¶…æ—¶æ–­å¼€ã€‚

---

### ä¿®å¤6ï¼šæ”¹è¿›èµ„æºæ¸…ç†é¡ºåº

```cpp
// ========== src/SDKManager.cpp ==========

void SDKManager::release() {
    if (!m_initialized) {
        return;
    }
    
    qDebug() << "[SDK] Releasing SDK resources...";
    
    // 1. åœæ­¢å®šæ—¶å™¨
    if (m_heartbeatSendTimer) {
        m_heartbeatSendTimer->stop();
        disconnect(m_heartbeatSendTimer.get(), nullptr, this, nullptr);
        qDebug() << "[SDK] Heartbeat send timer stopped";
    }
    if (m_heartbeatCheckTimer) {
        m_heartbeatCheckTimer->stop();
        disconnect(m_heartbeatCheckTimer.get(), nullptr, this, nullptr);
        qDebug() << "[SDK] Heartbeat check timer stopped";
    }
    
    // 2. æ–­å¼€ä¿¡å·è¿æ¥
    if (m_tcpClient) {
        disconnect(m_tcpClient.get(), nullptr, this, nullptr);
        qDebug() << "[SDK] TcpClient signals disconnected";
    }
    if (m_protocol) {
        disconnect(m_protocol.get(), nullptr, this, nullptr);
        qDebug() << "[SDK] Protocol signals disconnected";
    }
    
    // 3. åŒæ­¥æ–­å¼€TCPè¿æ¥
    if (m_tcpClient && m_tcpClient->isConnected()) {
        qDebug() << "[SDK] Disconnecting from host...";
        m_tcpClient->disconnectFromHost();
        
        // ç­‰å¾…æ–­å¼€å®Œæˆï¼ˆæœ€å¤š1ç§’ï¼‰
        if (m_tcpClient->state() != QAbstractSocket::UnconnectedState) {
            m_tcpClient->waitForDisconnected(1000);
        }
        qDebug() << "[SDK] Disconnected";
    }
    
    // 4. å¤„ç†å¾…å¤„ç†çš„äº‹ä»¶
    if (QCoreApplication::instance()) {
        QCoreApplication::processEvents();
    }
    
    // 5. æ¸…ç†èµ„æº
    m_heartbeatSendTimer.reset();
    m_heartbeatCheckTimer.reset();
    m_protocol.reset();
    m_tcpClient.reset();
    
    m_initialized = false;
    qDebug() << "[SDK] SDK released";
}
```

**éªŒè¯**: å¿«é€Ÿåˆå§‹åŒ–-é‡Šæ”¾å¤šæ¬¡ï¼Œä¸åº”å´©æºƒã€‚

---

## ğŸ“ å¯é€‰æ”¹è¿›ï¼ˆLow Priorityï¼‰

### æ”¹è¿›1ï¼šç»Ÿä¸€é”™è¯¯ç 

```cpp
// ========== PrintDeviceSDK_API.h ==========

// åœ¨ç°æœ‰å®šä¹‰åæ·»åŠ ï¼š

/**
 * @brief SDKé”™è¯¯ç å®šä¹‰
 */
typedef enum {
    SDK_SUCCESS = 0,              ///< æˆåŠŸ
    SDK_ERR_GENERAL = -1,         ///< ä¸€èˆ¬é”™è¯¯
    SDK_ERR_NOT_INITIALIZED = -2, ///< SDKæœªåˆå§‹åŒ–
    SDK_ERR_NO_CONNECTION = -3,   ///< æœªè¿æ¥åˆ°è®¾å¤‡
    SDK_ERR_INVALID_PARAM = -4,   ///< æ— æ•ˆå‚æ•°
    SDK_ERR_FILE_ERROR = -5,      ///< æ–‡ä»¶é”™è¯¯
    SDK_ERR_TIMEOUT = -6,         ///< è¶…æ—¶
    SDK_ERR_NO_QT_APP = -7,       ///< æ²¡æœ‰Qtåº”ç”¨å®ä¾‹
    SDK_ERR_WRONG_THREAD = -8     ///< çº¿ç¨‹é”™è¯¯
} SdkErrorCode;
```

ç„¶ååœ¨å„ä¸ªå‡½æ•°ä¸­ä½¿ç”¨ï¼š

```cpp
int ConnectByTCP(const char* ip, unsigned short port) {
    if (!ip) {
        return SDK_ERR_INVALID_PARAM;
    }
    
    if (!SDKManager::instance()->isInitialized()) {
        return SDK_ERR_NOT_INITIALIZED;
    }
    
    return SDKManager::instance()->connectByTCP(
        QString::fromUtf8(ip), port);
}
```

---

### æ”¹è¿›2ï¼šæ·»åŠ ç‰ˆæœ¬ä¿¡æ¯

```cpp
// ========== PrintDeviceSDK_API.h ==========

// ç‰ˆæœ¬ä¿¡æ¯
#define SDK_VERSION_MAJOR 1
#define SDK_VERSION_MINOR 0
#define SDK_VERSION_PATCH 0
#define SDK_VERSION_STRING "1.0.0"

/**
 * @brief è·å–SDKç‰ˆæœ¬å­—ç¬¦ä¸²
 * @return ç‰ˆæœ¬å­—ç¬¦ä¸²ï¼Œå¦‚"1.0.0"
 */
SDK_API const char* GetSDKVersion();

/**
 * @brief è·å–SDKä¸»ç‰ˆæœ¬å·
 * @return ä¸»ç‰ˆæœ¬å·
 */
SDK_API int GetSDKVersionMajor();

/**
 * @brief è·å–SDKæ¬¡ç‰ˆæœ¬å·
 * @return æ¬¡ç‰ˆæœ¬å·
 */
SDK_API int GetSDKVersionMinor();

/**
 * @brief è·å–SDKè¡¥ä¸ç‰ˆæœ¬å·
 * @return è¡¥ä¸ç‰ˆæœ¬å·
 */
SDK_API int GetSDKVersionPatch();
```

```cpp
// ========== PrintDeviceSDK_API.cpp ==========

const char* GetSDKVersion() {
    return SDK_VERSION_STRING;
}

int GetSDKVersionMajor() {
    return SDK_VERSION_MAJOR;
}

int GetSDKVersionMinor() {
    return SDK_VERSION_MINOR;
}

int GetSDKVersionPatch() {
    return SDK_VERSION_PATCH;
}
```

---

### æ”¹è¿›3ï¼šæ·»åŠ æ—¥å¿—çº§åˆ«æ§åˆ¶

```cpp
// ========== PrintDeviceSDK_API.h ==========

/**
 * @brief SDKæ—¥å¿—çº§åˆ«
 */
typedef enum {
    SDK_LOG_NONE = 0,    ///< æ— æ—¥å¿—
    SDK_LOG_ERROR = 1,   ///< ä»…é”™è¯¯
    SDK_LOG_WARNING = 2, ///< é”™è¯¯å’Œè­¦å‘Š
    SDK_LOG_INFO = 3,    ///< ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯
    SDK_LOG_DEBUG = 4    ///< æ‰€æœ‰æ—¥å¿—ï¼ˆåŒ…æ‹¬è°ƒè¯•ï¼‰
} SdkLogLevel;

/**
 * @brief è®¾ç½®SDKæ—¥å¿—çº§åˆ«
 * @param level æ—¥å¿—çº§åˆ«
 */
SDK_API void SetSDKLogLevel(SdkLogLevel level);
```

---

## âœ… ä¿®å¤éªŒè¯æ¸…å•

å®Œæˆæ‰€æœ‰ä¿®å¤åï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ¸…å•éªŒè¯ï¼š

### ç¼–è¯‘éªŒè¯

- [ ] ç¼–è¯‘æ— é”™è¯¯
- [ ] ç¼–è¯‘æ— è­¦å‘Š
- [ ] MOCæ–‡ä»¶æ­£ç¡®ç”Ÿæˆ
- [ ] DLL/SOæ­£ç¡®ç”Ÿæˆ

### åŠŸèƒ½éªŒè¯

- [ ] åˆå§‹åŒ–æˆåŠŸ
- [ ] æ— Qtåº”ç”¨æ—¶åˆå§‹åŒ–å¤±è´¥ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰
- [ ] è¿æ¥è®¾å¤‡æˆåŠŸ
- [ ] å¿ƒè·³æœºåˆ¶æ­£å¸¸
- [ ] 30ç§’å¿ƒè·³è¶…æ—¶æ­£å¸¸è§¦å‘
- [ ] æ‰“å°åŠŸèƒ½æ­£å¸¸
- [ ] è¿åŠ¨æ§åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] ä¸­æ–‡è·¯å¾„å›¾åƒåŠ è½½æ­£å¸¸

### å•ä¾‹éªŒè¯

- [ ] å¤šæ¬¡è°ƒç”¨`instance()`è¿”å›åŒä¸€å®ä¾‹
- [ ] ä¿¡å·æ­£ç¡®å‘é€åˆ°å•ä¾‹å®ä¾‹

### èµ„æºç®¡ç†éªŒè¯

- [ ] å¿«é€Ÿåˆå§‹åŒ–-é‡Šæ”¾ä¸å´©æºƒ
- [ ] é•¿æ—¶é—´è¿è¡Œæ— å†…å­˜æ³„æ¼
- [ ] ç¨‹åºé€€å‡ºæ—¶æ­£å¸¸æ¸…ç†

---

## ğŸ“Š ä¿®å¤æ—¶é—´ä¼°ç®—

| ä¿®å¤é¡¹ | ä¼˜å…ˆçº§ | æ—¶é—´ |
|--------|--------|------|
| MOCåŒ…å«ä½ç½® | é«˜ | 5åˆ†é’Ÿ |
| å­—ç¬¦ä¸²ç¼–ç  | é«˜ | 10åˆ†é’Ÿ |
| å•ä¾‹æ¨¡å¼æ”¹é€  | é«˜ | 30åˆ†é’Ÿ |
| Qtäº‹ä»¶å¾ªç¯æ£€æŸ¥ | ä¸­ | 15åˆ†é’Ÿ |
| å¿ƒè·³é€»è¾‘è°ƒæ•´ | ä¸­ | 15åˆ†é’Ÿ |
| èµ„æºæ¸…ç†æ”¹è¿› | ä¸­ | 20åˆ†é’Ÿ |
| **é«˜ä¼˜å…ˆçº§æ€»è®¡** | - | **45åˆ†é’Ÿ** |
| **å…¨éƒ¨ä¿®å¤æ€»è®¡** | - | **1.5å°æ—¶** |

---

## ğŸ“ ä¿®å¤åæµ‹è¯•è„šæœ¬

```cpp
// test_sdk_fixes.cpp
#include <QCoreApplication>
#include <QDebug>
#include "PrintDeviceController.h"

int main(int argc, char *argv[])
{
    QCoreApplication app(argc, argv);
    
    qDebug() << "=== SDKä¿®å¤éªŒè¯æµ‹è¯• ===";
    
    // æµ‹è¯•1ï¼šå•ä¾‹æ¨¡å¼
    qDebug() << "\n[æµ‹è¯•1] å•ä¾‹æ¨¡å¼";
    auto* ctrl1 = PrintDeviceController::instance();
    auto* ctrl2 = PrintDeviceController::instance();
    qDebug() << "å®ä¾‹1:" << ctrl1;
    qDebug() << "å®ä¾‹2:" << ctrl2;
    qDebug() << "ç›¸åŒå®ä¾‹?" << (ctrl1 == ctrl2 ? "æ˜¯âœ…" : "å¦âŒ");
    
    // æµ‹è¯•2ï¼šåˆå§‹åŒ–
    qDebug() << "\n[æµ‹è¯•2] åˆå§‹åŒ–";
    bool initOk = ctrl1->initialize("./logs");
    qDebug() << "åˆå§‹åŒ–ç»“æœ:" << (initOk ? "æˆåŠŸâœ…" : "å¤±è´¥âŒ");
    
    // æµ‹è¯•3ï¼šè¿æ¥ï¼ˆéœ€è¦å®é™…è®¾å¤‡ï¼‰
    qDebug() << "\n[æµ‹è¯•3] è¿æ¥æµ‹è¯•";
    bool connOk = ctrl1->connectToDevice("192.168.100.57", 5555);
    qDebug() << "è¿æ¥å‘½ä»¤å‘é€:" << (connOk ? "æˆåŠŸâœ…" : "å¤±è´¥âŒ");
    
    // ç­‰å¾…è¿æ¥ç»“æœ
    QObject::connect(ctrl1, &PrintDeviceController::connected, []() {
        qDebug() << "è¿æ¥æˆåŠŸâœ…";
    });
    QObject::connect(ctrl1, &PrintDeviceController::errorOccurred, 
                    [](int code, const QString& msg) {
        qDebug() << "é”™è¯¯âŒ:" << code << msg;
    });
    
    qDebug() << "\n=== æµ‹è¯•å®Œæˆ ===";
    
    return app.exec();
}
```

ç¼–è¯‘è¿è¡Œï¼š
```bash
qmake test_sdk_fixes.pro
nmake
test_sdk_fixes.exe
```

---

## ğŸ“ æ€»ç»“

**å¿…é¡»ä¿®å¤çš„é—®é¢˜**: 3ä¸ªï¼ˆçº¦45åˆ†é’Ÿï¼‰  
**å»ºè®®ä¿®å¤çš„é—®é¢˜**: 3ä¸ªï¼ˆçº¦45åˆ†é’Ÿï¼‰  
**å¯é€‰æ”¹è¿›**: 3ä¸ªï¼ˆçº¦30åˆ†é’Ÿï¼‰

**æ€»å·¥ä½œé‡**: 1.5-2å°æ—¶

ä¿®å¤å®Œæˆåï¼ŒSDKå³å¯å®‰å…¨ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚æ‰€æœ‰ä¿®å¤éƒ½å·²æä¾›è¯¦ç»†ä»£ç ï¼Œå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ã€‚

---

**ä¸‹ä¸€æ­¥**: åº”ç”¨ä¿®å¤ â†’ éªŒè¯æµ‹è¯• â†’ æ›´æ–°æ–‡æ¡£ â†’ å‘å¸ƒæ–°ç‰ˆæœ¬

